<script type="module">
    // Importer Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    // Configuration Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyDVibu5Mv4R_RGwueA-hRG_7D889FXqWR8",
        authDomain: "futursideloader.firebaseapp.com",
        projectId: "futursideloader",
        storageBucket: "futursideloader.firebasestorage.app",
        messagingSenderId: "426216859785",
        appId: "1:426216859785:web:2e8aca2b6f38a0856ffe58"
    };

    // Initialisation Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // V√©rifier l'√©tat de connexion de l'utilisateur
    onAuthStateChanged(auth, async (user) => {
        if (user) {
            console.log("‚úÖ Utilisateur connect√© :", user.email);

            // R√©cup√©rer les infos de l'utilisateur dans Firestore
            const userRef = doc(db, "users", user.uid);
            const userSnap = await getDoc(userRef);

            if (userSnap.exists()) {
                const userData = userSnap.data();
                const isPremium = userData.subscriptionStatus === "Premium";
                
                console.log("üõ°Ô∏è Statut premium :", isPremium);
                
                // Sauvegarde le statut premium
                localStorage.setItem("premium", isPremium);

                // Met √† jour les boutons de connexion
                updateUI(user.email);
            } else {
                console.log("‚ùå Utilisateur trouv√© mais pas de donn√©es Firestore !");
            }
        } else {
            console.log("‚ùå Aucun utilisateur connect√© !");
            localStorage.setItem("premium", "false");
            updateUI(null);
        }
    });

    // Mettre √† jour l'interface utilisateur
    function updateUI(email) {
        const navContainer = document.querySelector(".nav-container");
        navContainer.innerHTML = ""; // Vider le conteneur avant d'ajouter

        if (email) {
            navContainer.innerHTML = `
                <span>üë§ ${email}</span>
                <button onclick="logout()" class="btn">Log out</button>
            `;
        } else {
            navContainer.innerHTML = `
                <button onclick="window.location.href='login.html'" class="btn">Log in</button>
                <button onclick="window.location.href='signup.html'" class="btn">Create account</button>
            `;
        }
    }

    // Fonction de d√©connexion
    function logout() {
        auth.signOut().then(() => {
            console.log("üö™ D√©connect√© !");
            window.location.reload();
        }).catch(error => {
            console.error("‚ùå Erreur de d√©connexion :", error);
        });
    }

    // Ajoute la fonction logout √† window pour qu'elle soit accessible globalement
    window.logout = logout;
</script>
